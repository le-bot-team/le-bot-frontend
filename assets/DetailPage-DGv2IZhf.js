import{Q as C}from"./QSkeleton-dbXw-hyC.js";import{Q as M}from"./QChip-C1KXrGUf.js";import{b2 as W,I as G,bc as U,bd as z,a as N,s as S,p as q,q as H,c as _,o as u,w as t,b as e,Q as D,k as b,g as v,E as A,t as d,u as s,j as y,be as B,aQ as K,n as I,D as J,v as x,an as X,r as T,l as P,i as V,m as Y,F as Z,bf as $}from"./index-DgppYffZ.js";import{Q as w}from"./QItemLabel-Ccua9sTh.js";import{Q as F,a as Q}from"./QItemSection-BwFW9rdQ.js";import{Q as ee}from"./QList-CzsJSU5B.js";import{Q as te}from"./QPage-rh9KbsCj.js";import{u as E}from"./use-quasar-S3hsX8ZC.js";import{u as O}from"./use-dialog-plugin-component-DTRSyCJh.js";import{d as ae,a as oe,b as se}from"./voiceprint-B4F7qAsF.js";import{i as L}from"./common-K7rkEdDd.js";import{R as ne}from"./vpr-relationships-KT3O57CZ.js";function R(a){if(a===!1)return 0;if(a===!0||a===void 0)return 1;const o=parseInt(a,10);return isNaN(o)?0:o}const j=W({name:"close-popup",beforeMount(a,{value:o}){const n={depth:R(o),handler(p){n.depth!==0&&setTimeout(()=>{const c=U(a);c!==void 0&&z(c,p,n.depth)})},handlerKey(p){G(p,13)===!0&&n.handler(p)}};a.__qclosepopup=n,a.addEventListener("click",n.handler),a.addEventListener("keyup",n.handlerKey)},updated(a,{value:o,oldValue:n}){o!==n&&(a.__qclosepopup.depth=R(o))},beforeUnmount(a){const o=a.__qclosepopup;a.removeEventListener("click",o.handler),a.removeEventListener("keyup",o.handlerKey),delete a.__qclosepopup}}),le={class:"text-h6"},ie={class:"text-weight-bold"},re=N({__name:"DeletePersonDialog",props:{personId:{},personName:{}},emits:["ok","hide"],setup(a){const o=a,{accessToken:n}=S(q()),{dialogRef:p,onDialogHide:c,onDialogOK:f,onDialogCancel:i}=O(),{notify:g}=E(),l=L("components.settings.voiceprint.DeletePersonDialog"),h=async()=>{if(n.value)try{const{data:r}=await ae(n.value,o.personId);r.success?(g({type:"positive",message:l("notifications.deleteSuccess")}),f()):g({type:"warning",message:l("notifications.deleteFailed"),caption:r.message})}catch(r){g({type:"negative",message:l("notifications.deleteError"),caption:r.message})}};return H(()=>{n.value||i()}),(r,m)=>(u(),_(K,{ref_key:"dialogRef",ref:p,onHide:s(c)},{default:t(()=>[e(D,{flat:""},{default:t(()=>[e(b,{class:"row items-center justify-between"},{default:t(()=>[v("div",le,d(s(l)("labels.title")),1),A(e(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),e(b,{class:"text-body1 q-gutter-y-md"},{default:t(()=>[v("div",null,d(s(l)("labels.deletePrompt",{personName:a.personName??a.personId})),1),v("div",ie,d(s(l)("labels.deleteWarning")),1)]),_:1}),e(B,{align:"right"},{default:t(()=>[e(y,{flat:"",label:s(l)("labels.confirm"),color:"negative","no-caps":"",onClick:h},null,8,["label"]),e(y,{color:"primary",label:s(l)("labels.cancel"),"no-caps":"",onClick:s(i)},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),ce={class:"text-h6"},de={class:"text-body1"},ue={class:"text-body1 text-weight-bold"},pe=N({__name:"DeleteVoiceDialog",props:{personId:{},personName:{},voiceId:{},createdAt:{}},emits:["ok","hide"],setup(a){const o=a,{accessToken:n}=S(q()),{dialogRef:p,onDialogHide:c,onDialogOK:f,onDialogCancel:i}=O(),{notify:g}=E(),l=L("components.settings.voiceprint.DeleteVoiceDialog"),h=async()=>{if(n.value)try{const{data:r}=await oe(n.value,o.personId,o.voiceId);r.success?(g({type:"positive",message:l("notifications.deleteSuccess")}),f()):g({type:"warning",message:l("notifications.deleteFailed"),caption:r.message})}catch(r){g({type:"negative",message:l("notifications.deleteError"),caption:r.message})}};return H(()=>{n.value||i()}),(r,m)=>(u(),_(K,{ref_key:"dialogRef",ref:p,onHide:s(c)},{default:t(()=>[e(D,{flat:""},{default:t(()=>[e(b,{class:"row items-center justify-between"},{default:t(()=>[v("div",ce,d(s(l)("labels.title")),1),A(e(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),e(b,{class:"q-gutter-y-md"},{default:t(()=>[e(D,{bordered:"",flat:""},{default:t(()=>[e(F,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(w,null,{default:t(()=>[I(d(new Date(o.createdAt).toLocaleString()),1)]),_:1}),e(w,{caption:""},{default:t(()=>[I(d(o.voiceId),1)]),_:1})]),_:1})]),_:1})]),_:1}),v("div",de,d(s(l)("labels.deletePrompt",{personName:a.personName??a.personId})),1),v("div",ue,d(s(l)("labels.deleteWarning")),1)]),_:1}),e(B,{align:"right"},{default:t(()=>[e(y,{flat:"",label:s(l)("labels.confirm"),color:"negative","no-caps":"",onClick:h},null,8,["label"]),e(y,{color:"primary",label:s(l)("labels.cancel"),"no-caps":"",onClick:s(i)},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),fe={class:"row justify-between items-center"},me={class:"column q-gutter-y-md"},ge={key:0,class:"text-body1"},_e={key:2,class:"text-caption text-grey"},ve={key:0,class:"absolute-top-right bg-orange text-caption q-px-xs"},ye={class:"text-body1"},Ee=N({__name:"DetailPage",setup(a){const{accessToken:o}=S(q()),{notify:n}=E(),p=X(),c=L("pages.stack.settings.voiceprint.DetailPage"),f=T(),i=T(),g=()=>{f.value&&$.create({component:re,componentProps:{personId:f.value,personName:i.value?.name}}).onOk(()=>setTimeout(()=>x.go(-1),2e3))},l=(r,m)=>{f.value&&$.create({component:pe,componentProps:{personId:f.value,personName:i.value?.name,voiceId:r,createdAt:m}}).onOk(()=>{o.value&&h(o.value).catch()})},h=async r=>{if(!f.value?.length)return!1;try{const{data:m}=await se(r,f.value);return m.success?(i.value=m.data,!0):(n({type:"warning",message:c("notifications.fetchPersonDetailFailed"),caption:m.message}),!1)}catch(m){return n({type:"negative",message:c("notifications.fetchPersonDetailError"),caption:m.message}),!1}};return J(async()=>{if(!o.value){await x.push("/stack/auth?from=/stack/settings/voiceprint");return}if(p.params.personId&&typeof p.params.personId=="string")f.value=p.params.personId;else{x.go(-1);return}await h(o.value)||setTimeout(()=>x.go(-1),2e3)}),(r,m)=>(u(),_(te,{class:"column q-gutter-y-md q-pa-md"},{default:t(()=>[e(D,{bordered:"",flat:""},{default:t(()=>[e(b,null,{default:t(()=>[v("div",fe,[v("div",me,[i.value?(u(),P("div",ge,d(s(c)("labels.name",{name:i.value.name})),1)):(u(),_(C,{key:1,type:"text"})),i.value?(u(),P("div",_e,d(s(c)("labels.id",{id:i.value.person_id})),1)):(u(),_(C,{key:3,type:"text"}))]),i.value?(u(),_(M,{key:0,color:"primary",label:s(ne)[i.value.relationship]},null,8,["label"])):(u(),_(C,{key:1,type:"QChip"}))])]),_:1}),i.value?.is_temporal?(u(),P("div",ve,d(s(c)("labels.temporary")),1)):V("",!0)]),_:1}),e(D,{bordered:"",flat:""},{default:t(()=>[e(b,null,{default:t(()=>[v("div",ye,d(s(c)("labels.voiceprints")),1)]),_:1}),i.value?(u(),_(b,{key:0},{default:t(()=>[e(ee,{bordered:"",separator:""},{default:t(()=>[(u(!0),P(Z,null,Y(i.value.voices,k=>(u(),_(F,{key:k.voice_id},{default:t(()=>[e(Q,null,{default:t(()=>[e(w,null,{default:t(()=>[I(d(new Date(k.created_at).toLocaleString()),1)]),_:2},1024),e(w,{caption:""},{default:t(()=>[I(d(k.voice_id),1)]),_:2},1024)]),_:2},1024),e(Q,{side:""},{default:t(()=>[e(y,{color:"negative",dense:"",icon:"delete",onClick:be=>l(k.voice_id,k.created_at)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):V("",!0),e(b,null,{default:t(()=>[e(y,{class:"full-width",color:"primary",label:s(c)("labels.addVoiceprint"),"no-caps":"",to:`/stack/settings/voiceprint/new?personId=${f.value}`},null,8,["label","to"])]),_:1})]),_:1}),e(y,{color:"negative",label:s(c)("labels.deletePerson"),"no-caps":"",onClick:g},null,8,["label"])]),_:1}))}});export{Ee as default};
