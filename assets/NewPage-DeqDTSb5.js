import{Q as N,a as A}from"./QTabPanel-CayJsXek.js";import{Q as j}from"./QPage-rh9KbsCj.js";import{a as S,B as O,r as p,c as U,w as o,b as e,g,Q as I,k as h,t as f,u as n,l as R,m as E,F,j as V,o as _,G as H,n as w,s as T,p as B,D as M,i as q,au as G,q as z,v as L,an as J}from"./index-DgppYffZ.js";import{Q as K,a as P}from"./QItemSection-BwFW9rdQ.js";import{Q as $}from"./QItemLabel-Ccua9sTh.js";import{Q as W}from"./QList-CzsJSU5B.js";import{i as C,a as X}from"./common-K7rkEdDd.js";import{_ as Y}from"./AudioRecorder.vue_vue_type_script_setup_true_lang-DT4HkkPm.js";import{Q as Z}from"./QSelect-b-Hj0yha.js";import{u as ee}from"./use-quasar-S3hsX8ZC.js";import{a as D}from"./vpr-relationships-KT3O57CZ.js";import{c as te,r as ae}from"./voiceprint-B4F7qAsF.js";import"./touch-BjYP5sR0.js";import"./selection-dIM8yNrf.js";import"./module-D3pM6jUg.js";import"./QChip-C1KXrGUf.js";import"./position-engine-BsAm_ntu.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const oe={class:"text-h6 text-center"},le={class:"text-h6 text-center"},se={class:"text-body1 text-center"},ne=["src"],re=S({__name:"RecordPanel",props:{name:{}},emits:["next"],setup(v,{emit:y}){const r=y,a=C("components.settings.voiceprint.RecordPanel"),c=[{icon:"volume_off",label:a("labels.quietEnvironment"),caption:a("labels.quietEnvironmentDescription")},{icon:"sentiment_neutral",label:a("labels.naturalVoice"),caption:a("labels.naturalVoiceDescription")},{icon:"straighten",label:a("labels.moderateDistance"),caption:a("labels.moderateDistanceDescription")}],l=p(),t=p(),s=x=>{l.value?l.value=new Blob([l.value,x],{type:"audio/wav"}):l.value=x},d=()=>{t.value&&URL.revokeObjectURL(t.value),t.value=l.value?URL.createObjectURL(l.value):void 0};return O(()=>{t.value&&URL.revokeObjectURL(t.value)}),(x,i)=>(_(),U(N,{class:"column q-gutter-y-md",name:v.name},{default:o(()=>[e(I,null,{default:o(()=>[e(h,null,{default:o(()=>[g("div",oe,f(n(a)("labels.preparation")),1)]),_:1}),e(W,null,{default:o(()=>[(_(),R(F,null,E(c,(m,k)=>e(K,{key:k},{default:o(()=>[e(P,{avatar:""},{default:o(()=>[e(H,{name:m.icon},null,8,["name"])]),_:2},1024),e(P,null,{default:o(()=>[e($,null,{default:o(()=>[w(f(m.label),1)]),_:2},1024),e($,{caption:""},{default:o(()=>[w(f(m.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1}),e(I,{class:"q-mt-xl"},{default:o(()=>[e(h,null,{default:o(()=>[g("div",le,f(n(a)("labels.readAloudPhrases")),1)]),_:1}),e(h,null,{default:o(()=>[g("div",se,f(n(a)("labels.readAloudPhrasesDescription")),1)]),_:1})]),_:1}),g("audio",{class:"full-width",controls:"",src:t.value},null,8,ne),e(Y,{onData:s,onStart:i[0]||(i[0]=m=>l.value=void 0),onStop:d}),e(V,{class:"q-mt-xl",color:"primary",disable:!t.value,label:n(a)("labels.finish"),"no-caps":"",onClick:i[1]||(i[1]=m=>l.value?r("next",l.value):void 0)},null,8,["disable","label"])]),_:1},8,["name"]))}}),ie=["src"],ue={key:0,class:"column q-gutter-y-sm"},ce={class:"text-body1 text-bold"},de={key:1,class:"column q-gutter-y-sm"},me={class:"text-body1 text-bold"},pe=S({__name:"SubmitPanel",props:{name:{},data:{},personId:{}},emits:["finish","previous"],setup(v,{emit:y}){const r=v,a=y,{accessToken:c}=T(B()),{notify:l}=ee(),t=C("components.settings.voiceprint.SubmitPanel"),s=p(),d=p(!1),x=p(30),i=p(),m=p(D[0]),k=async()=>{if(!c.value){console.error("No access token available for voiceprint registration.");return}if(!r.data){console.error("No audio data provided for voiceprint registration.");return}d.value=!0;try{const b=await X(r.data);let u;if(r.personId?.length)u=(await te(c.value,r.personId,b.substring(b.indexOf(",")+1))).data;else{if(!i.value||!i.value.length){console.error("Person name is required for voiceprint registration.");return}if(!m.value){console.error("Relationship is required for voiceprint registration.");return}u=(await ae(c.value,b.substring(b.indexOf(",")+1),i.value,x.value,m.value.value)).data}u.success?(l({type:"positive",message:t("notifications.registrationSuccess")}),setTimeout(()=>a("finish"),1500)):l({type:"negative",message:t("notifications.registrationFailed",{message:u.message})}),a("finish")}catch(b){console.error("Error during voiceprint registration:",b),l({type:"negative",message:t("notifications.registrationError")})}finally{d.value=!1}};return M(()=>{if(!r.data){a("previous");return}s.value=URL.createObjectURL(r.data)}),O(()=>{s.value&&URL.revokeObjectURL(s.value)}),(b,u)=>(_(),U(N,{class:"column q-gutter-y-lg",name:v.name},{default:o(()=>[e(I,null,{default:o(()=>[e(h,{class:"text-body1"},{default:o(()=>[w(f(n(t)("labels.hint")),1)]),_:1}),e(h,null,{default:o(()=>[g("audio",{class:"full-width",controls:"",src:s.value},null,8,ie)]),_:1})]),_:1}),v.personId?.length?q("",!0):(_(),R("div",ue,[g("div",ce,f(n(t)("labels.whoseVoice")),1),e(G,{clearable:"",label:n(t)("labels.whoseVoiceHint"),outlined:"",modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=Q=>i.value=Q)},null,8,["label","modelValue"])])),v.personId?.length?q("",!0):(_(),R("div",de,[g("div",me,f(n(t)("labels.relationship")),1),e(Z,{label:n(t)("labels.relationshipHint"),options:n(D),outlined:"",modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=Q=>m.value=Q)},null,8,["label","options","modelValue"])])),e(V,{color:"primary",disable:!v.data||!v.personId?.length&&!i.value?.length,label:n(t)("labels.confirm"),"no-caps":"",onClick:k},null,8,["disable","label"]),e(V,{color:"negative",label:n(t)("labels.previous"),"no-caps":"",outline:"",onClick:u[2]||(u[2]=Q=>a("previous"))},null,8,["label"])]),_:1},8,["name"]))}}),$e=S({__name:"NewPage",setup(v){const{accessToken:y}=T(B()),r=J(),a=p(),c=p(0),l=p();return z(async()=>{if(!y.value){await L.push("/stack/auth?from=/stack/settings/voiceprint/new");return}typeof r.query.personId=="string"&&(l.value=r.query.personId)}),(t,s)=>(_(),U(j,{class:"column q-gutter-y-lg q-pa-md"},{default:o(()=>[e(A,{class:"full-width col-grow bg-transparent",modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=d=>c.value=d)},{default:o(()=>[e(re,{name:0,onNext:s[0]||(s[0]=d=>{a.value=d,c.value=1})}),e(pe,{name:1,data:a.value,"person-id":l.value,onFinish:s[1]||(s[1]=d=>n(L).go(-1)),onPrevious:s[2]||(s[2]=d=>c.value=0)},null,8,["data","person-id"])]),_:1},8,["modelValue"])]),_:1}))}});export{$e as default};
