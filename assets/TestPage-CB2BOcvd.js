import{a as y,s as _,p as k,q as R,v as d,B as w,r,c as S,w as l,b as n,k as p,n as U,t as B,u as f,g as h,Q as x,j as L,o as Q}from"./index-DgppYffZ.js";import{Q as T}from"./QPage-rh9KbsCj.js";import{u as C}from"./use-quasar-S3hsX8ZC.js";import{_ as N}from"./AudioRecorder.vue_vue_type_script_setup_true_lang-DT4HkkPm.js";import{i as j,a as D}from"./common-K7rkEdDd.js";import{e as O}from"./voiceprint-B4F7qAsF.js";import"./module-D3pM6jUg.js";const P=["src"],G=y({__name:"TestPage",setup(q){const{accessToken:c}=_(k()),{notify:u}=C(),s=j("pages.stack.settings.voiceprint.TestPage"),o=r(),t=r(),i=r(!1),v=r(),g=a=>{o.value?o.value=new Blob([o.value,a],{type:"audio/wav"}):o.value=a},m=async()=>{if(i.value=!0,t.value&&URL.revokeObjectURL(t.value),!o.value){t.value=void 0,i.value=!1;return}if(t.value=URL.createObjectURL(o.value),!c.value){console.error("No access token available for voiceprint recognition."),i.value=!1;return}try{const a=await D(o.value),{data:e}=await O(c.value,a.substring(a.indexOf(",")+1));e.success?(u({type:"positive",message:s("notifications.recognitionSuccess",{personName:e.data.name,confidence:e.data.confidence.toFixed(2)})}),v.value=e.data,console.log("Recognition result:",v.value)):u({type:"warning",message:s("notifications.recognitionFailed"),caption:e.message})}catch(a){console.error("Error during voiceprint recognition:",a),u({type:"negative",message:s("notifications.registrationError"),caption:a.message})}finally{i.value=!1}};return R(async()=>{if(!c.value){await d.push("/stack/auth?from=/stack/settings/voiceprint/test");return}}),w(()=>{t.value&&URL.revokeObjectURL(t.value)}),(a,e)=>(Q(),S(T,{class:"column q-gutter-y-lg q-pa-md"},{default:l(()=>[n(x,null,{default:l(()=>[n(p,{class:"text-body1"},{default:l(()=>[U(B(f(s)("labels.hint")),1)]),_:1}),n(p,null,{default:l(()=>[h("audio",{class:"full-width",controls:"",src:t.value},null,8,P)]),_:1})]),_:1}),n(N,{onData:g,onStart:e[0]||(e[0]=b=>o.value=void 0),onStop:m}),n(L,{color:"primary",disable:!t.value,label:f(s)("labels.finish"),"no-caps":"",onClick:e[1]||(e[1]=b=>f(d).go(-1))},null,8,["disable","label"])]),_:1}))}});export{G as default};
